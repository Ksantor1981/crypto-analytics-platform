<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Crypto Analytics - –§–ò–ù–ê–õ–¨–ù–´–ï –†–ï–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00d4ff, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-size: 0.9em;
            color: #aaa;
        }

        select, input {
            padding: 8px 12px;
            border: 1px solid #444;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
        }

        select option {
            background: #1a1a2e;
            color: white;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
            color: #000;
            font-weight: bold;
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #fd7e14, #dc3545);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            font-weight: bold;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #c82333, #a71e2a);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            font-weight: bold;
        }

        .btn-info:hover {
            background: linear-gradient(135deg, #138496, #117a8b);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(23, 162, 184, 0.4);
        }

        .automation-panel {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }

        .automation-panel.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .task-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: #2a2a2a;
            border-radius: 5px;
            border-left: 3px solid #007bff;
        }

        .task-status.running {
            border-left-color: #28a745;
            background: #0d2818;
        }

        .task-status.error {
            border-left-color: #dc3545;
            background: #2d0a0e;
        }

        .task-status.pending {
            border-left-color: #ffc107;
            background: #2d2a0a;
        }

        .user-sources-panel {
            position: fixed;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            background: #2a2d3a;
            border: 2px solid #3a3d4a;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .user-sources-panel .panel-header {
            background: #3a3d4a;
            padding: 15px;
            border-bottom: 1px solid #4a4d5a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-sources-panel .panel-content {
            padding: 20px;
        }

        .add-source-form {
            background: #3a3d4a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #fff;
            font-weight: bold;
        }

        .form-control {
            width: 100%;
            padding: 8px 12px;
            background: #2a2d3a;
            border: 1px solid #4a4d5a;
            border-radius: 4px;
            color: #fff;
            font-size: 14px;
        }

        .form-control:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        .user-source-item {
            background: #3a3d4a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #007bff;
        }

        .user-source-item.verified {
            border-left-color: #28a745;
        }

        .user-source-item.poor-quality {
            border-left-color: #dc3545;
        }

        .source-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .source-title {
            font-weight: bold;
            color: #fff;
        }

        .source-platform {
            background: #007bff;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .source-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .source-stat {
            text-align: center;
            padding: 8px;
            background: #2a2d3a;
            border-radius: 4px;
        }

        .source-stat-value {
            display: block;
            font-weight: bold;
            color: #fff;
        }

        .source-stat-label {
            font-size: 12px;
            color: #aaa;
        }

        .source-actions {
            margin-top: 10px;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 12px;
            margin-right: 5px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #00d4ff;
        }

        .stat-label {
            color: #aaa;
            margin-top: 5px;
        }

        .signals-table {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        th {
            background: rgba(255, 255, 255, 0.1);
            font-weight: bold;
            color: #00d4ff;
        }

        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .status-pending { background: #ffa500; color: #000; }
        .status-tp1_hit { background: #00ff00; color: #000; }
        .status-sl_hit { background: #ff4444; color: #fff; }
        .status-entry_hit { background: #4444ff; color: #fff; }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ–∂–∏–¥–∞–µ–º—ã—Ö –¥–∞—Ç */
        .expected-date {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            color: white;
            text-align: center;
            display: inline-block;
            min-width: 60px;
        }

        .expected-date.expired {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            animation: pulse 2s infinite;
        }

        .expected-date.urgent {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            animation: pulse 1.5s infinite;
        }

        .expected-date.soon {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .expected-date.normal {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .no-expiry {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            color: white;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }

        .price {
            font-weight: bold;
            color: #00ff88;
        }

        .source {
            font-size: 0.9em;
            color: #aaa;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { background: #00ff88; color: #000; }
        .notification.error { background: #ff4444; }
        .notification.info { background: #00d4ff; color: #000; }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #aaa;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #aaa;
        }

        .refresh-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }

        .refresh-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff88;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .winrate {
            font-weight: bold;
            color: #00ff88;
        }

        .accuracy-badge {
            font-size: 0.8em;
            padding: 2px 6px;
            border-radius: 10px;
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Crypto Analytics Platform</h1>
            <p>–§–ò–ù–ê–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø - –¢–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∂–∏–≤—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤</p>
            <div class="status success">‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –†–ï–ê–õ–¨–ù–´–ï</div>
            <div class="status success">‚ö° –§–∏–ª—å—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç</div>
            <div class="status success">üìä –í–∏–Ω—Ä–µ–π—Ç—ã —Ç–æ—á–Ω—ã–µ</div>
        </div>

        <div class="controls">
            <div class="filter-group">
                <label>–ê–∫—Ç–∏–≤:</label>
                <select id="assetFilter">
                    <option value="">–í—Å–µ –∞–∫—Ç–∏–≤—ã</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>–°—Ç–∞—Ç—É—Å:</label>
                <select id="statusFilter">
                    <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                    <option value="PENDING">–û–∂–∏–¥–∞–µ—Ç</option>
                    <option value="TP1_HIT">–¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞</option>
                    <option value="SL_HIT">–°—Ç–æ–ø-–ª–æ—Å—Å</option>
                    <option value="ENTRY_HIT">–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω</option>
                </select>
            </div>

            <div class="filter-group">
                <label>–ò—Å—Ç–æ—á–Ω–∏–∫:</label>
                <select id="sourceFilter">
                    <option value="">–í—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏</option>
                    <option value="301">CQS API</option>
                    <option value="302">CTA API</option>
                    <option value="401">CryptoPapa</option>
                    <option value="200">Reddit</option>
                    <option value="400">Telegram</option>
                </select>
            </div>

            <div class="filter-group">
                <label>–õ–∏–º–∏—Ç:</label>
                <select id="limitFilter">
                    <option value="10">10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
            </div>

            <button class="btn btn-primary" onclick="applyFilters()">üîç –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
            <button class="btn btn-primary" onclick="refreshData()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>

            <button class="btn btn-danger" onclick="analyzeChannelQuality()">üìä –ê–Ω–∞–ª–∏–∑ –∫–∞–Ω–∞–ª–æ–≤ + –ê–Ω—Ç–∏—Ä–µ–π—Ç–∏–Ω–≥</button>
            <button class="btn btn-secondary" onclick="fixSignalDates()">üìÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥–∞—Ç—ã —Å–∏–≥–Ω–∞–ª–æ–≤</button>
            <button class="btn btn-success" onclick="testSignalValidation()">üß™ –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏</button>
                                <button class="btn btn-info" onclick="toggleAutomationPanel()">ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è</button>
                    <button class="btn btn-primary" onclick="toggleUserSourcesPanel()">üìÅ –ú–æ–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏</button>

            <div class="refresh-status">
                <div class="refresh-indicator"></div>
                <span id="lastUpdate">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>

            <!-- –ü–∞–Ω–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ -->
            <div id="automationPanel" class="automation-panel">
                <h3 style="color: #17a2b8; margin-bottom: 20px;">ü§ñ –ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´</h3>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #ffc107;">‚è∞ –ï–ñ–ï–ß–ê–°–ù–´–ï –ó–ê–î–ê–ß–ò:</h4>
                    <div class="task-status" id="task-collect-signals">
                        <div>
                            <strong>üöÄ –°–±–æ—Ä —Å–∏–≥–Ω–∞–ª–æ–≤ –∏–∑ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤</strong><br>
                            <small>–ö–∞–∂–¥—ã–π —á–∞—Å: Telegram, Reddit, External APIs</small>
                        </div>
                        <div id="status-collect-signals">
                            <span class="badge badge-info">–ì–æ—Ç–æ–≤</span>
                        </div>
                    </div>
                    
                    <div class="task-status" id="task-recalc-stats">
                        <div>
                            <strong>üìä –ü–µ—Ä–µ—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞–Ω–∞–ª–æ–≤</strong><br>
                            <small>–ö–∞–∂–¥—ã–π —á–∞—Å: –≤–∏–Ω—Ä–µ–π—Ç—ã, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –∫–∞—á–µ—Å—Ç–≤–æ</small>
                        </div>
                        <div id="status-recalc-stats">
                            <span class="badge badge-info">–ì–æ—Ç–æ–≤</span>
                        </div>
                    </div>
                    
                    <div class="task-status" id="task-analyze-channels">
                        <div>
                            <strong>üîç –ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–∞–Ω–∞–ª–æ–≤</strong><br>
                            <small>–ö–∞–∂–¥—ã–π —á–∞—Å: —Ä–µ–π—Ç–∏–Ω–≥ + –∞–Ω—Ç–∏—Ä–µ–π—Ç–∏–Ω–≥</small>
                        </div>
                        <div id="status-analyze-channels">
                            <span class="badge badge-info">–ì–æ—Ç–æ–≤</span>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <h4 style="color: #fd7e14;">‚ö° –ë–´–°–¢–†–´–ï –ü–†–û–í–ï–†–ö–ò:</h4>
                    <div class="task-status" id="task-check-results">
                        <div>
                            <strong>‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–∏–≥–Ω–∞–ª–æ–≤</strong><br>
                            <small>–ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç</small>
                        </div>
                        <div id="status-check-results">
                            <span class="badge badge-success">–ê–∫—Ç–∏–≤–Ω–æ</span>
                        </div>
                    </div>
                    
                    <div class="task-status" id="task-monitor-prices">
                        <div>
                            <strong>üí∞ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ü–µ–Ω</strong><br>
                            <small>–ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç</small>
                        </div>
                        <div id="status-monitor-prices">
                            <span class="badge badge-success">–ê–∫—Ç–∏–≤–Ω–æ</span>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <h4 style="color: #6f42c1;">üìà –†–ê–°–®–ò–†–ï–ù–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê:</h4>
                    <div class="task-status" id="task-deep-analysis">
                        <div>
                            <strong>üî¨ –ì–ª—É–±–æ–∫–∏–π –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑</strong><br>
                            <small>–ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤</small>
                        </div>
                        <div id="status-deep-analysis">
                            <span class="badge badge-info">–ì–æ—Ç–æ–≤</span>
                        </div>
                    </div>
                    
                    <div class="task-status" id="task-update-ratings">
                        <div>
                            <strong>‚≠ê –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤</strong><br>
                            <small>–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</small>
                        </div>
                        <div id="status-update-ratings">
                            <span class="badge badge-info">–ì–æ—Ç–æ–≤</span>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-success" onclick="runManualCollection()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–±–æ—Ä –≤—Ä—É—á–Ω—É—é</button>
                    <button class="btn btn-warning" onclick="checkSystemHealth()">ü©∫ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É</button>
                    <button class="btn btn-secondary" onclick="refreshAutomationStatus()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
                </div>
            </div>
        </div>

        <div class="stats-grid" id="statsGrid">
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>

        <div class="signals-table">
            <table>
                <thead>
                    <tr>
                        <th>–ê–∫—Ç–∏–≤</th>
                        <th>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th>
                        <th>–í—Ö–æ–¥</th>
                        <th>–¶–µ–ª—å</th>
                        <th>–°—Ç–æ–ø</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>Confidence</th>
                        <th>–ò—Å—Ç–æ—á–Ω–∏–∫</th>
                        <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                        <th>–û–∂–∏–¥–∞–µ–º–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</th>
                    </tr>
                </thead>
                <tbody id="signalsTableBody">
                    <tr>
                        <td colspan="10" class="loading">üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div id="userSourcesPanel" class="user-sources-panel" style="display: none;">
        <div class="panel-header">
            <h3>üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏</h3>
            <button class="btn btn-close" onclick="toggleUserSourcesPanel()">‚úñ</button>
        </div>
        
        <div class="panel-content">
            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ -->
            <div class="add-source-form">
                <h4>‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫</h4>
                <div class="form-group">
                    <label>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</label>
                    <select id="sourcePlatform" class="form-control">
                        <option value="telegram">Telegram</option>
                        <option value="discord">Discord</option>
                        <option value="reddit">Reddit</option>
                        <option value="twitter">Twitter</option>
                        <option value="website">–í–µ–±-—Å–∞–π—Ç</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>URL –∏—Å—Ç–æ—á–Ω–∏–∫–∞:</label>
                    <input type="text" id="sourceUrl" class="form-control" 
                           placeholder="https://t.me/channel_name">
                </div>
                
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                    <input type="text" id="sourceName" class="form-control" 
                           placeholder="–ú–æ–π —Ç–æ—Ä–≥–æ–≤—ã–π –∫–∞–Ω–∞–ª">
                </div>
                
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                    <textarea id="sourceDescription" class="form-control" rows="2" 
                              placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞"></textarea>
                </div>
                
                <div class="form-group">
                    <label>–û–∂–∏–¥–∞–µ–º–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ:</label>
                    <select id="sourceExpectedAccuracy" class="form-control">
                        <option value="unknown">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</option>
                        <option value="high">–í—ã—Å–æ–∫–æ–µ</option>
                        <option value="medium">–°—Ä–µ–¥–Ω–µ–µ</option>
                        <option value="low">–ù–∏–∑–∫–æ–µ</option>
                    </select>
                </div>
                
                <button class="btn btn-success" onclick="addUserSource()">üîç –î–æ–±–∞–≤–∏—Ç—å –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
            
            <!-- –°–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ -->
            <div class="user-sources-list">
                <h4>üìã –ú–æ–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏</h4>
                <div id="userSourcesList">
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allSignals = [];
        let filteredSignals = [];

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        window.addEventListener('load', async () => {
            await loadSignals();
            await loadChannelStats();
            startAutoRefresh();
        });

        async function loadSignals() {
            try {
                showNotification('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤...', 'info');
                
                const response = await fetch('http://localhost:8000/api/v1/signals/dashboard?limit=100');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const signals = await response.json();
                allSignals = signals;
                filteredSignals = signals;
                
                updateSignalsTable();
                updateAssetFilter();
                updateLastUpdateTime();
                
                showNotification(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${signals.length} —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤`, 'success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
                document.getElementById('signalsTableBody').innerHTML = 
                    '<tr><td colspan="9" class="no-data">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</td></tr>';
            }
        }

        async function loadChannelStats() {
            try {
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                const stats = calculateStats(allSignals);
                updateStatsGrid(stats);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        function calculateStats(signals) {
            const totalSignals = signals.length;
            const uniqueAssets = new Set(signals.map(s => s.asset)).size;
            const sources = new Set(signals.map(s => s.channel_id)).size;
            
            const successfulSignals = signals.filter(s => s.status === 'TP1_HIT').length;
            const failedSignals = signals.filter(s => s.status === 'SL_HIT').length;
            const completedSignals = successfulSignals + failedSignals;
            
            const winrate = completedSignals > 0 ? ((successfulSignals / completedSignals) * 100).toFixed(1) : '0.0';
            
            return {
                totalSignals,
                uniqueAssets,
                sources,
                winrate: winrate + '%',
                pendingSignals: signals.filter(s => s.status === 'PENDING').length
            };
        }

        function updateStatsGrid(stats) {
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${stats.totalSignals}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Å–∏–≥–Ω–∞–ª–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.uniqueAssets}</div>
                    <div class="stat-label">–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∞–∫—Ç–∏–≤–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.sources}</div>
                    <div class="stat-label">–ò—Å—Ç–æ—á–Ω–∏–∫–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number winrate">${stats.winrate}</div>
                    <div class="stat-label">–û–±—â–∏–π –≤–∏–Ω—Ä–µ–π—Ç</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.pendingSignals}</div>
                    <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤</div>
                </div>
            `;
        }

        function updateSignalsTable() {
            const tbody = document.getElementById('signalsTableBody');
            
            if (filteredSignals.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</td></tr>';
                return;
            }

            tbody.innerHTML = filteredSignals.map(signal => `
                <tr>
                    <td><strong>${signal.asset}</strong></td>
                    <td>${signal.direction}</td>
                    <td class="price">$${formatPrice(signal.entry_price)}</td>
                    <td class="price">$${formatPrice(signal.tp1_price)}</td>
                    <td class="price">$${formatPrice(signal.stop_loss)}</td>
                    <td><span class="status status-${signal.status.toLowerCase()}">${getStatusLabel(signal.status)}</span></td>
                    <td>${(signal.confidence_score * 100).toFixed(0)}%</td>
                    <td class="source">${signal.channel_name}</td>
                    <td>${formatDate(signal.created_at)}</td>
                    <td class="expected-date">${formatExpectedDate(signal.expires_at)}</td>
                </tr>
            `).join('');
        }

        function updateAssetFilter() {
            const assetFilter = document.getElementById('assetFilter');
            const uniqueAssets = [...new Set(allSignals.map(s => s.asset))].sort();
            
            assetFilter.innerHTML = '<option value="">–í—Å–µ –∞–∫—Ç–∏–≤—ã</option>' + 
                uniqueAssets.map(asset => `<option value="${asset}">${asset}</option>`).join('');
        }

        function applyFilters() {
            const assetFilter = document.getElementById('assetFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const sourceFilter = document.getElementById('sourceFilter').value;
            const limitFilter = parseInt(document.getElementById('limitFilter').value);

            filteredSignals = allSignals.filter(signal => {
                if (assetFilter && signal.asset !== assetFilter) return false;
                if (statusFilter && signal.status !== statusFilter) return false;
                if (sourceFilter && signal.channel_id.toString() !== sourceFilter) return false;
                return true;
            });

            // –ü—Ä–∏–º–µ–Ω—è–µ–º –ª–∏–º–∏—Ç
            filteredSignals = filteredSignals.slice(0, limitFilter);

            updateSignalsTable();
            showNotification(`üîç –ü–æ–∫–∞–∑–∞–Ω–æ ${filteredSignals.length} —Å–∏–≥–Ω–∞–ª–æ–≤`, 'info');
        }

        async function refreshData() {
            await loadSignals();
            await loadChannelStats();
            applyFilters();
        }

        function startAutoRefresh() {
            setInterval(async () => {
                await loadSignals();
                await loadChannelStats();
                applyFilters();
            }, 60000); // –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
        }





        async function analyzeChannelQuality() {
            try {
                showNotification('üìä –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–∞–Ω–∞–ª–æ–≤ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∞–Ω—Ç–∏—Ä–µ–π—Ç–∏–Ω–≥–∞...', 'info');
                
                const response = await fetch('http://localhost:8000/api/v1/telegram/analyze-channel-quality', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(`‚úÖ ${result.message}! –°–æ–∑–¥–∞–Ω —Ä–µ–π—Ç–∏–Ω–≥ –∏ –∞–Ω—Ç–∏—Ä–µ–π—Ç–∏–Ω–≥ –∫–∞–Ω–∞–ª–æ–≤.`, 'success');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞
                    console.log('üìä –¢–û–ü-3 –õ–£–ß–®–ò–• –ö–ê–ù–ê–õ–û–í:', result.top_3_channels);
                    console.log('üíÄ –¢–û–ü-3 –•–£–î–®–ò–• –ö–ê–ù–ê–õ–û–í (–ê–ù–¢–ò–†–ï–ô–¢–ò–ù–ì):', result.worst_3_channels);
                    console.log('üìã –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑:', result.full_analysis);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ
                    displayChannelAnalysis(result);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞
                    await loadSignals();
                    await loadChannelStats();
                    applyFilters();
                } else {
                    showNotification(`‚ùå ${result.message}`, 'error');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –∫–∞–Ω–∞–ª–æ–≤:', error);
                showNotification(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        function displayChannelAnalysis(result) {
            // –°–æ–∑–¥–∞–µ–º –æ–∫–Ω–æ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∞–Ω–∞–ª–∏–∑–∞
            const analysisHtml = `
                <div style="background: #1a1a1a; padding: 20px; border-radius: 10px; margin: 20px 0; max-height: 400px; overflow-y: auto;">
                    <h3 style="color: #00d4ff; margin-bottom: 15px;">üìä –ê–ù–ê–õ–ò–ó –ö–ê–ù–ê–õ–û–í –ó–ê–í–ï–†–®–ï–ù</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #28a745;">üèÜ –¢–û–ü-3 –õ–£–ß–®–ò–• –ö–ê–ù–ê–õ–û–í:</h4>
                        ${result.top_3_channels.map((channel, index) => `
                            <div style="background: #0d4127; padding: 10px; margin: 5px 0; border-radius: 5px; border-left: 3px solid #28a745;">
                                <strong>${index + 1}. ${channel.channel_name}</strong> 
                                <span style="color: #28a745;">Score: ${channel.quality_score}</span><br>
                                üë• –ü–æ–¥–ø–∏—Å—á–∏–∫–∏: ${channel.subscriber_count || 'N/A'} | 
                                üìä –°–∏–≥–Ω–∞–ª—ã: ${channel.signal_frequency} | 
                                ‚≠ê –†–µ–π—Ç–∏–Ω–≥: ${channel.quality_rating}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div>
                        <h4 style="color: #dc3545;">üíÄ –¢–û–ü-3 –•–£–î–®–ò–• –ö–ê–ù–ê–õ–û–í (–ê–ù–¢–ò–†–ï–ô–¢–ò–ù–ì):</h4>
                        ${result.worst_3_channels.map((channel, index) => `
                            <div style="background: #4a1a1a; padding: 10px; margin: 5px 0; border-radius: 5px; border-left: 3px solid #dc3545;">
                                <strong>${index + 1}. ${channel.channel_name}</strong> 
                                <span style="color: #dc3545;">Score: ${channel.quality_score}</span><br>
                                üë• –ü–æ–¥–ø–∏—Å—á–∏–∫–∏: ${channel.subscriber_count || 'N/A'} | 
                                üìä –°–∏–≥–Ω–∞–ª—ã: ${channel.signal_frequency} | 
                                ‚≠ê –†–µ–π—Ç–∏–Ω–≥: ${channel.quality_rating}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="margin-top: 15px; padding: 10px; background: #333; border-radius: 5px;">
                        <small style="color: #aaa;">
                            üìà –í—Å–µ–≥–æ –∫–∞–Ω–∞–ª–æ–≤: ${result.total_channels} | 
                            ‚úÖ –ê–∫—Ç–∏–≤–Ω—ã—Ö: ${result.active_channels} | 
                            üïê –ê–Ω–∞–ª–∏–∑: ${new Date().toLocaleString()}
                        </small>
                    </div>
                </div>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –Ω–∞—á–∞–ª–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            const container = document.querySelector('.container');
            container.insertAdjacentHTML('afterbegin', analysisHtml);
        }

        function toggleAutomationPanel() {
            const panel = document.getElementById('automationPanel');
            panel.classList.toggle('show');
            
            if (panel.classList.contains('show')) {
                refreshAutomationStatus();
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
        function toggleUserSourcesPanel() {
            const panel = document.getElementById('userSourcesPanel');
            if (panel.style.display === 'none' || panel.style.display === '') {
                panel.style.display = 'block';
                loadUserSources();
            } else {
                panel.style.display = 'none';
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
        async function loadUserSources() {
            try {
                showNotification('–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤...', 'info');
                
                const response = await fetch('/api/v1/user-sources/my-sources');
                const data = await response.json();
                
                const container = document.getElementById('userSourcesList');
                
                if (data.success && data.sources) {
                    container.innerHTML = data.sources.map(source => `
                        <div class="user-source-item ${source.is_verified ? 'verified' : ''} ${source.quality_score < 0.4 ? 'poor-quality' : ''}">
                            <div class="source-header">
                                <div class="source-title">${source.name}</div>
                                <div class="source-platform">${source.platform}</div>
                            </div>
                            
                            <div class="source-info">
                                <strong>@${source.username}</strong>
                                ${source.status ? `<span class="badge badge-${source.status === 'active' ? 'success' : 'warning'}">${source.status}</span>` : ''}
                            </div>
                            
                            <div class="source-stats">
                                <div class="source-stat">
                                    <span class="source-stat-value">${source.quality_score ? (source.quality_score * 100).toFixed(0) : 0}%</span>
                                    <span class="source-stat-label">–ö–∞—á–µ—Å—Ç–≤–æ</span>
                                </div>
                                <div class="source-stat">
                                    <span class="source-stat-value">${source.total_signals || 0}</span>
                                    <span class="source-stat-label">–°–∏–≥–Ω–∞–ª–æ–≤</span>
                                </div>
                                <div class="source-stat">
                                    <span class="source-stat-value">${source.win_rate ? source.win_rate.toFixed(1) : 0}%</span>
                                    <span class="source-stat-label">–í–∏–Ω—Ä–µ–π—Ç</span>
                                </div>
                                <div class="source-stat">
                                    <span class="source-stat-value">${source.subscribers_count || 'N/A'}</span>
                                    <span class="source-stat-label">–ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</span>
                                </div>
                            </div>
                            
                            <div class="source-actions">
                                <button class="btn btn-sm btn-primary" onclick="reanalyzeSource(${source.id})">üîÑ –ü–µ—Ä–µ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
                                <button class="btn btn-sm btn-danger" onclick="removeUserSource(${source.id})">üóë –£–¥–∞–ª–∏—Ç—å</button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<div class="text-center">–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤', 'error');
                document.getElementById('userSourcesList').innerHTML = '<div class="text-center text-danger">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
        async function addUserSource() {
            try {
                const platform = document.getElementById('sourcePlatform').value;
                const sourceUrl = document.getElementById('sourceUrl').value.trim();
                const name = document.getElementById('sourceName').value.trim();
                const description = document.getElementById('sourceDescription').value.trim();
                const expectedAccuracy = document.getElementById('sourceExpectedAccuracy').value;
                
                if (!platform || !sourceUrl || !name) {
                    showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
                    return;
                }
                
                showNotification('–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞...', 'info');
                
                const response = await fetch('/api/v1/user-sources/add-source', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        platform: platform,
                        source_url: sourceUrl,
                        name: name,
                        description: description,
                        expected_accuracy: expectedAccuracy
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification(`–ò—Å—Ç–æ—á–Ω–∏–∫ "${name}" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!`, 'success');
                    
                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    document.getElementById('sourceUrl').value = '';
                    document.getElementById('sourceName').value = '';
                    document.getElementById('sourceDescription').value = '';
                    
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                    loadUserSources();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞
                    if (data.analysis) {
                        const analysis = data.analysis;
                        showNotification(
                            `–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω: –ö–∞—á–µ—Å—Ç–≤–æ ${(analysis.quality_score * 100).toFixed(0)}%, –°–∏–≥–Ω–∞–ª–æ–≤ –Ω–∞–π–¥–µ–Ω–æ: ${analysis.signals_found}`, 
                            'info'
                        );
                    }
                    
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞', 'error');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞', 'error');
            }
        }

        // –ü–µ—Ä–µ–∞–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
        async function reanalyzeSource(channelId) {
            try {
                showNotification('–ó–∞–ø—É—Å–∫ –ø–µ—Ä–µ–∞–Ω–∞–ª–∏–∑–∞...', 'info');
                
                const response = await fetch(`/api/v1/user-sources/reanalyze/${channelId}`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('–ü–µ—Ä–µ–∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!', 'success');
                    loadUserSources(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∞–Ω–∞–ª–∏–∑–∞', 'error');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∞–Ω–∞–ª–∏–∑–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∞–Ω–∞–ª–∏–∑–∞', 'error');
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
        async function removeUserSource(channelId) {
            if (!confirm('–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫?')) {
                return;
            }
            
            try {
                showNotification('–£–¥–∞–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞...', 'info');
                
                const response = await fetch(`/api/v1/user-sources/remove/${channelId}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('–ò—Å—Ç–æ—á–Ω–∏–∫ —É–¥–∞–ª–µ–Ω!', 'success');
                    loadUserSources(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);
                showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞', 'error');
            }
        }

        async function refreshAutomationStatus() {
            try {
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å API –≤—ã–∑–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ Celery –∑–∞–¥–∞—á
                // –ü–æ–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∏–º—É–ª—è—Ü–∏—é
                updateTaskStatus('status-collect-signals', 'ready', '–ì–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É');
                updateTaskStatus('status-recalc-stats', 'ready', '–ì–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É');
                updateTaskStatus('status-analyze-channels', 'ready', '–ì–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É');
                updateTaskStatus('status-check-results', 'running', '–ê–∫—Ç–∏–≤–Ω–æ');
                updateTaskStatus('status-monitor-prices', 'running', '–ê–∫—Ç–∏–≤–Ω–æ');
                updateTaskStatus('status-deep-analysis', 'ready', '–ì–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É');
                updateTaskStatus('status-update-ratings', 'ready', '–ì–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É');
                
                showNotification('üîÑ –°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω', 'info');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞', 'error');
            }
        }

        function updateTaskStatus(elementId, status, text) {
            const element = document.getElementById(elementId);
            if (element) {
                let badgeClass = 'badge-info';
                let statusText = text;
                
                switch (status) {
                    case 'running':
                        badgeClass = 'badge-success';
                        statusText = 'üü¢ ' + text;
                        break;
                    case 'error':
                        badgeClass = 'badge-danger';
                        statusText = 'üî¥ ' + text;
                        break;
                    case 'pending':
                        badgeClass = 'badge-warning';
                        statusText = 'üü° ' + text;
                        break;
                    default:
                        badgeClass = 'badge-info';
                        statusText = '‚ö™ ' + text;
                }
                
                element.innerHTML = `<span class="badge ${badgeClass}">${statusText}</span>`;
            }
        }

        async function runManualCollection() {
            try {
                showNotification('üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º —Ä—É—á–Ω–æ–π —Å–±–æ—Ä —Å–∏–≥–Ω–∞–ª–æ–≤...', 'info');
                updateTaskStatus('status-collect-signals', 'running', '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...');
                
                const response = await fetch('http://localhost:8000/api/v1/telegram/collect-all-sources', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('‚úÖ –†—É—á–Ω–æ–π —Å–±–æ—Ä —Å–∏–≥–Ω–∞–ª–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
                    updateTaskStatus('status-collect-signals', 'ready', '–ó–∞–≤–µ—Ä—à–µ–Ω–æ');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                    await loadSignals();
                    await loadChannelStats();
                    applyFilters();
                } else {
                    showNotification(`‚ùå ${result.message}`, 'error');
                    updateTaskStatus('status-collect-signals', 'error', '–û—à–∏–±–∫–∞');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ä—É—á–Ω–æ–≥–æ —Å–±–æ—Ä–∞:', error);
                showNotification(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                updateTaskStatus('status-collect-signals', 'error', '–û—à–∏–±–∫–∞');
            }
        }

        async function checkSystemHealth() {
            try {
                showNotification('ü©∫ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã...', 'info');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º API
                const response = await fetch('http://localhost:8000/health');
                const health = await response.json();
                
                if (response.ok) {
                    showNotification('‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ', 'success');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                    const healthInfo = `
                        <div style="background: #0d2818; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 3px solid #28a745;">
                            <h4 style="color: #28a745;">ü©∫ –°–û–°–¢–û–Ø–ù–ò–ï –°–ò–°–¢–ï–ú–´</h4>
                            <p><strong>API:</strong> ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç</p>
                            <p><strong>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:</strong> ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∞</p>
                            <p><strong>–í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏:</strong> ${new Date().toLocaleString()}</p>
                        </div>
                    `;
                    
                    const container = document.querySelector('.container');
                    container.insertAdjacentHTML('afterbegin', healthInfo);
                } else {
                    showNotification('‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–∏—Å—Ç–µ–º–æ–π', 'error');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏—Å—Ç–µ–º—ã:', error);
                showNotification('‚ùå –°–∏—Å—Ç–µ–º–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', 'error');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
                updateTaskStatus('status-collect-signals', 'error', '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ');
                updateTaskStatus('status-recalc-stats', 'error', '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ');
                updateTaskStatus('status-analyze-channels', 'error', '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ');
            }
        }

        async function fixSignalDates() {
            try {
                showNotification('üìÖ –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –¥–∞—Ç—ã —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ...', 'info');
                
                const response = await fetch('http://localhost:8000/api/v1/telegram/fix-signal-dates', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(`‚úÖ ${result.message}`, 'success');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                    const fixInfo = `
                        <div style="background: #0d2818; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 3px solid #28a745;">
                            <h4 style="color: #28a745;">üìÖ –î–ê–¢–´ –°–ò–ì–ù–ê–õ–û–í –ò–°–ü–†–ê–í–õ–ï–ù–´</h4>
                            <p><strong>–û–±–Ω–æ–≤–ª–µ–Ω–æ —Å–∏–≥–Ω–∞–ª–æ–≤:</strong> ${result.time_groups_found || 'N/A'} –≥—Ä—É–ø–ø</p>
                            <p><strong>–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:</strong> ${result.explanation}</p>
                            <p><strong>–¢–µ–ø–µ—Ä—å:</strong> –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è = –≤—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–∞ (–Ω–µ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ –≤ –ë–î)</p>
                            <small>–°–∏–≥–Ω–∞–ª—ã —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –†–ï–ê–õ–¨–ù–û–ï –≤—Ä–µ–º—è –∏—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–∏!</small>
                        </div>
                    `;
                    
                    const container = document.querySelector('.container');
                    container.insertAdjacentHTML('afterbegin', fixInfo);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞—Ç
                    await loadSignals();
                    applyFilters();
                } else {
                    showNotification(`‚ùå ${result.message}`, 'error');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞—Ç:', error);
                showNotification(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        async function testSignalValidation() {
            try {
                showNotification('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å–∏–≥–Ω–∞–ª–æ–≤...', 'info');
                
                const response = await fetch('http://localhost:8000/api/v1/telegram/test-signal-validation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(`‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ü—Ä–∏–Ω—è—Ç–æ: ${result.sync_accepted}/8, –û—Ç–±—Ä–æ—à–µ–Ω–æ: ${result.sync_rejected}/8`, 'success');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                    const validationInfo = `
                        <div style="background: #0d2818; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 3px solid #28a745;">
                            <h4 style="color: #28a745;">üß™ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø –í–ê–õ–ò–î–ê–¶–ò–ò</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 15px 0;">
                                <div>
                                    <h5 style="color: #28a745;">‚úÖ –†–ï–ê–õ–ò–°–¢–ò–ß–ù–´–ï –°–ò–ì–ù–ê–õ–´ (–ü–†–ò–ù–Ø–¢–´):</h5>
                                    <ul style="color: #aaa; font-size: 0.9em;">
                                        ${result.results.filter(r => r.sync_accepted).map(r => 
                                            `<li>‚úÖ ${r.test_signal}</li>`
                                        ).join('')}
                                    </ul>
                                </div>
                                <div>
                                    <h5 style="color: #dc3545;">‚ùå –ú–ê–ì–ò–Ø –ò –í–û–õ–®–ï–ë–°–¢–í–û (–û–¢–ë–†–û–®–ï–ù–´):</h5>
                                    <ul style="color: #aaa; font-size: 0.9em;">
                                        ${result.results.filter(r => !r.sync_accepted).map(r => 
                                            `<li>‚ùå ${r.test_signal}</li>`
                                        ).join('')}
                                    </ul>
                                </div>
                            </div>
                            <p><strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</strong> Sync –∞–ª–≥–æ—Ä–∏—Ç–º: ${result.sync_accepted} –ø—Ä–∏–Ω—è—Ç–æ, ${result.sync_rejected} –æ—Ç–±—Ä–æ—à–µ–Ω–æ</p>
                            <p><strong>Async –∞–ª–≥–æ—Ä–∏—Ç–º:</strong> ${result.async_accepted} –ø—Ä–∏–Ω—è—Ç–æ, ${result.async_rejected} –æ—Ç–±—Ä–æ—à–µ–Ω–æ</p>
                            <p><strong>–ö—Ä–∏—Ç–µ—Ä–∏–π:</strong> –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç —Ä—ã–Ω–æ—á–Ω–æ–π —Ü–µ–Ω—ã –Ω–µ –±–æ–ª–µ–µ 15%</p>
                            <small>–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–∏–≥–Ω–∞–ª—ã —Å –Ω–µ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏!</small>
                        </div>
                    `;
                    
                    const container = document.querySelector('.container');
                    container.insertAdjacentHTML('afterbegin', validationInfo);
                    
                } else {
                    showNotification(`‚ùå ${result.message}`, 'error');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏:', error);
                showNotification(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        function formatPrice(price) {
            if (!price) return 'N/A';
            if (price < 0.01) return price.toFixed(8);
            if (price < 1) return price.toFixed(6);
            if (price < 100) return price.toFixed(4);
            return price.toFixed(2);
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU') + ' ' + date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
        }

        function formatExpectedDate(dateString) {
            if (!dateString) return '<span class="no-expiry">–ë–µ—Å—Å—Ä–æ—á–Ω–æ</span>';
            
            const now = new Date();
            const expectedDate = new Date(dateString);
            const diffMs = expectedDate - now;
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffHours / 24);
            
            let timeRemaining = '';
            let className = '';
            
            if (diffMs < 0) {
                timeRemaining = '–ü—Ä–æ—Å—Ä–æ—á–µ–Ω';
                className = 'expired';
            } else if (diffHours < 24) {
                timeRemaining = `${diffHours}—á`;
                className = diffHours < 6 ? 'urgent' : 'soon';
            } else if (diffDays < 7) {
                timeRemaining = `${diffDays}–¥`;
                className = diffDays < 2 ? 'soon' : 'normal';
            } else {
                timeRemaining = expectedDate.toLocaleDateString('ru-RU', {
                    day: '2-digit',
                    month: '2-digit'
                });
                className = 'normal';
            }
            
            return `<span class="expected-date ${className}" title="${formatDate(dateString)}">${timeRemaining}</span>`;
        }

        function getStatusLabel(status) {
            const labels = {
                'PENDING': '–û–∂–∏–¥–∞–µ—Ç',
                'TP1_HIT': '–¶–µ–ª—å ‚úÖ',
                'SL_HIT': '–°—Ç–æ–ø ‚ùå',
                'ENTRY_HIT': '–í—Ö–æ–¥ ‚úì'
            };
            return labels[status] || status;
        }

        function getSourceName(channelId) {
            const sources = {
                200: 'üì± Reddit',
                300: 'üåê External APIs', 
                301: 'üìä CQS API',
                302: 'üìà CTA API',
                400: 'üí¨ Telegram',
                401: 'üöÄ CryptoPapa',
                402: 'üê∑ FatPigSignals', 
                403: '‚ö° BinanceKiller',
                404: 'üåç CryptoSignalsWorld',
                405: 'üíé CryptoPumps'
            };
            return sources[channelId] || `üìã Unknown Source ${channelId}`;
        }

        function updateLastUpdateTime() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = 
                `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${now.toLocaleTimeString('ru-RU')}`;
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
        document.getElementById('assetFilter').addEventListener('change', applyFilters);
        document.getElementById('statusFilter').addEventListener('change', applyFilters);
        document.getElementById('sourceFilter').addEventListener('change', applyFilters);
        document.getElementById('limitFilter').addEventListener('change', applyFilters);
    </script>
</body>
</html>
