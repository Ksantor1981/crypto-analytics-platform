# ü§ñ ML Signal Prediction Service

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–ù–æ–≤—ã–π ML-—Å–µ—Ä–≤–∏—Å –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤, —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Å –Ω—É–ª—è –¥–ª—è –æ–±—Ö–æ–¥–∞ –ø—Ä–æ–±–ª–µ–º —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ —Ñ–∞–π–ª–∞–º. –°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç RandomForest –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–∞ —É—Å–ø–µ—à–Ω—ã–µ/–Ω–µ—É—Å–ø–µ—à–Ω—ã–µ.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### SignalPredictionService
- **–ö–ª–∞—Å—Å:** `SignalPredictionService` –≤ `app/services/signal_prediction_service.py`
- **–ú–æ–¥–µ–ª—å:** RandomForestClassifier —Å 100 –¥–µ—Ä–µ–≤—å—è–º–∏
- **–ü—Ä–∏–∑–Ω–∞–∫–∏:** 9 –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ —Å–∏–≥–Ω–∞–ª–æ–≤ –∏ –∫–∞–Ω–∞–ª–æ–≤
- **–¶–µ–ª–µ–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è:** 1 (—É—Å–ø–µ—à–µ–Ω) / 0 (–Ω–µ—É—Å–ø–µ—à–µ–Ω)

### API Endpoints
- **–ë–∞–∑–æ–≤—ã–π –ø—É—Ç—å:** `/api/v1/ml-prediction`
- **–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:** 7 –æ—Å–Ω–æ–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å ML-–º–æ–¥–µ–ª—å—é

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
```bash
cd backend
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –µ—Å—Ç—å:
- –¢–∞–±–ª–∏—Ü–∞ `signal_results` —Å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–º–∏ —Å–∏–≥–Ω–∞–ª–∞–º–∏
- –ú–∏–Ω–∏–º—É–º 20 –∑–∞–ø–∏—Å–µ–π –¥–ª—è –æ–±—É—á–µ–Ω–∏—è (–∏–ª–∏ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ)

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
cd backend
python test_signal_prediction.py
```

## üìä API Endpoints

### 1. –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
```http
POST /api/v1/ml-prediction/train
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "success",
  "message": "–ú–æ–¥–µ–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±—É—á–µ–Ω–∞",
  "data": {
    "success": true,
    "accuracy": 0.872,
    "training_samples": 80,
    "test_samples": 20,
    "feature_importance": {
      "channel_accuracy": 0.234,
      "signal_confidence": 0.189,
      "success_rate": 0.156,
      ...
    },
    "last_training_date": "2025-07-25T10:30:00"
  }
}
```

### 2. –°—Ç–∞—Ç—É—Å –º–æ–¥–µ–ª–∏
```http
GET /api/v1/ml-prediction/model-status
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "success",
  "data": {
    "is_trained": true,
    "last_training_date": "2025-07-25T10:30:00",
    "model_accuracy": 0.872,
    "feature_names": ["signal_count", "channel_accuracy", ...],
    "model_type": "RandomForestClassifier"
  }
}
```

### 3. –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞
```http
POST /api/v1/ml-prediction/predict/{signal_id}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "success",
  "signal_id": 1,
  "prediction": {
    "success": true,
    "prediction": 1,
    "confidence": 0.856,
    "features": {
      "signal_count": 15,
      "channel_accuracy": 0.78,
      ...
    },
    "model_accuracy": 0.872
  }
}
```

### 4. Batch –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
```http
POST /api/v1/ml-prediction/batch-predict
Content-Type: application/json

[1, 2, 3, 4, 5]
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "success",
  "predictions": [
    {
      "signal_id": 1,
      "prediction": {
        "success": true,
        "prediction": 1,
        "confidence": 0.856
      }
    },
    ...
  ],
  "total_signals": 5
}
```

### 5. –í–∞–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
```http
GET /api/v1/ml-prediction/feature-importance
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "success",
  "feature_importance": {
    "channel_accuracy": 0.234,
    "signal_confidence": 0.189,
    "success_rate": 0.156,
    "avg_roi": 0.123,
    "channel_followers": 0.098
  },
  "model_accuracy": 0.872
}
```

### 6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
```http
POST /api/v1/ml-prediction/save-model
```

### 7. –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏
```http
POST /api/v1/ml-prediction/load-model
```

### 8. Health Check
```http
GET /api/v1/ml-prediction/health
```

## üîç –ü—Ä–∏–∑–Ω–∞–∫–∏ –º–æ–¥–µ–ª–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏:
1. **signal_count** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –∫–∞–Ω–∞–ª–∞
2. **channel_accuracy** - —Ç–æ—á–Ω–æ—Å—Ç—å –∫–∞–Ω–∞–ª–∞ (–ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤)
3. **avg_roi** - —Å—Ä–µ–¥–Ω–∏–π ROI –∫–∞–Ω–∞–ª–∞
4. **success_rate** - –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
5. **days_since_last_signal** - –¥–Ω–µ–π —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–∏–≥–Ω–∞–ª–∞
6. **channel_followers** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –∫–∞–Ω–∞–ª–∞
7. **channel_age_days** - –≤–æ–∑—Ä–∞—Å—Ç –∫–∞–Ω–∞–ª–∞ –≤ –¥–Ω—è—Ö
8. **signal_confidence** - —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–∏–≥–Ω–∞–ª–µ
9. **market_volatility** - –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —Ä—ã–Ω–∫–∞

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
python test_signal_prediction.py
```

**–¢–µ—Å—Ç—ã –≤–∫–ª—é—á–∞—é—Ç:**
- ‚úÖ Health Check
- ‚úÖ Model Status
- ‚úÖ Model Training
- ‚úÖ Single Prediction
- ‚úÖ Batch Prediction
- ‚úÖ Feature Importance
- ‚úÖ Model Save/Load

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ curl
```bash
# –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
curl -X POST http://localhost:8000/api/v1/ml-prediction/train

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
curl http://localhost:8000/api/v1/ml-prediction/model-status

# –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
curl -X POST http://localhost:8000/api/v1/ml-prediction/predict/1
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–∂–∏–¥–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- **–¢–æ—á–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏:** 85-90%
- **–í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è:** 5-15 —Å–µ–∫—É–Ω–¥ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–±—ä–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö)
- **–í—Ä–µ–º—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è:** <100ms
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ batch:** –¥–æ 100 —Å–∏–≥–Ω–∞–ª–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ StandardScaler –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –≤ –ø–∞–º—è—Ç–∏
- Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ —Ä–µ–∞–ª—å–Ω—ã—Ö

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
# –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–∏
MODEL_SAVE_PATH=models/signal_prediction_model.pkl

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏
RF_N_ESTIMATORS=100
RF_MAX_DEPTH=10
RF_RANDOM_STATE=42
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥–µ–ª–∏:
```python
# –í signal_prediction_service.py
self.model = RandomForestClassifier(
    n_estimators=100,    # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ä–µ–≤—å–µ–≤
    max_depth=10,        # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞
    random_state=42      # –î–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏
)
```

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏:
1. **"–ú–æ–¥–µ–ª—å –Ω–µ –æ–±—É—á–µ–Ω–∞"** - —Å–Ω–∞—á–∞–ª–∞ –æ–±—É—á–∏—Ç–µ –º–æ–¥–µ–ª—å
2. **"–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö"** - –º–∏–Ω–∏–º—É–º 10 –∑–∞–ø–∏—Å–µ–π –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
3. **"–°–∏–≥–Ω–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ ID —Å–∏–≥–Ω–∞–ª–∞
4. **"–ö–∞–Ω–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤—è–∑—å —Å–∏–≥–Ω–∞–ª-–∫–∞–Ω–∞–ª

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```python
import logging
logger = logging.getLogger(__name__)
logger.info("–ú–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é: {accuracy}")
logger.error("–û—à–∏–±–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è: {error}")
```

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ main.py:
```python
from .api.endpoints import ml_prediction
app.include_router(ml_prediction.router, prefix="/api/v1/ml-prediction", tags=["ml-prediction"])
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö:
```python
from app.services.signal_prediction_service import signal_prediction_service

# –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –≤ signal_service.py
prediction = signal_prediction_service.predict_signal_success(signal, channel, db)
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
- –¢–æ—á–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏ (accuracy)
- –í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è –∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
- –ß–∞—Å—Ç–æ—Ç–∞ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏

### Health Check:
```bash
curl http://localhost:8000/api/v1/ml-prediction/health
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. **Ensemble –º–æ–¥–µ–ª–∏** - –∫–æ–º–±–∏–Ω–∞—Ü–∏—è RandomForest + XGBoost
2. **Feature Engineering** - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
3. **Hyperparameter tuning** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
4. **Real-time learning** - –æ–Ω–ª–∞–π–Ω –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
5. **Model versioning** - –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
6. **A/B testing** - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å trading:
1. **Risk scoring** - –æ—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤ —Å–∏–≥–Ω–∞–ª–æ–≤
2. **Position sizing** - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
3. **Portfolio optimization** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ä—Ç—Ñ–µ–ª—è
4. **Stop-loss optimization** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç–æ–ø-–ª–æ—Å—Å–æ–≤

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `test_signal_prediction.py`
3. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –Ω–∞–ª–∏—á–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API endpoints

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É
**–í–µ—Ä—Å–∏—è:** 1.0.0
**–î–∞—Ç–∞:** 25.07.2025 